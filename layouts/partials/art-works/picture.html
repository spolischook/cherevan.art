<div class="relative">
    <picture class="">
        <source type="image/avif"
                srcset="{{ .image.RelPermalink | replaceRE "(?i)\\.(jpg|jpeg|png|gif|bmp|tiff)" "_360.avif" }} 360w,
                    {{ .image.RelPermalink | replaceRE "(?i)\\.(jpg|jpeg|png|gif|bmp|tiff)" "_375.avif" }} 375w,
                    {{ .image.RelPermalink | replaceRE "(?i)\\.(jpg|jpeg|png|gif|bmp|tiff)" "_768.avif" }} 768w">
        <source type="image/webp"
                srcset="{{ .image.RelPermalink | replaceRE "(?i)\\.(jpg|jpeg|png|gif|bmp|tiff)" "_360.webp" }} 360w,
                    {{ .image.RelPermalink | replaceRE "(?i)\\.(jpg|jpeg|png|gif|bmp|tiff)" "_375.webp" }} 375w,
                    {{ .image.RelPermalink | replaceRE "(?i)\\.(jpg|jpeg|png|gif|bmp|tiff)" "_768.webp" }} 768w">
        {{ $lowQualityImage := .image.Resize "100x" }}
        {{ $lowQualityImageBase64 := $lowQualityImage.Content | base64Encode }}
        <img class="object-cover w-full h-full"
             style="aspect-ratio: {{.image.Width}}/{{.image.Height}}"
             alt="{{ .title }}"
                {{ if ge .index 5 }}
                    src="{{.image.RelPermalink}}"
                {{else}}
                    src="data:image/jpeg;base64,{{ $lowQualityImageBase64 }}"
                    onload="this.onload=null; this.src='{{.image.RelPermalink}}'"
                {{end}}
             srcset="{{.image.RelPermalink | replaceRE "(?i)\\.(jpg|jpeg|png|gif|bmp|tiff)" "_360.webp"}} 360w,
                {{.image.RelPermalink | replaceRE "(?i)\\.(jpg|jpeg|png|gif|bmp|tiff)" "_375.webp"}} 375w,
                {{.image.RelPermalink | replaceRE "(?i)\\.(jpg|jpeg|png|gif|bmp|tiff)" "_768.webp"}} 768w"
             sizes="(max-width: 360px) 360px, (max-width: 375px) 375px, 768px"
                {{ if ge .index 5 }}loading="lazy"{{ end }}>
    </picture>
    {{ if not .inStock }}
        <div class="absolute w-8 h-8 bg-red-500 bottom-5 right-5 rounded-full shadow-xl" title="out of stock"></div>
    {{ end }}
</div>

